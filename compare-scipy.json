{"version":3,"kind":"Notebook","sha256":"2fd72149b1cbc377fcf72b16a73094f696cf5e4d5884a2690be7eebbf8a4c181","slug":"compare-scipy","location":"/compare_scipy.md","dependencies":[],"frontmatter":{"title":"Boundary Behavior Comparison: smoothing_spline vs scipy","kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"jupytext":{"formats":"md:myst","text_representation":{"extension":".md","format_name":"myst","format_version":"0.13","jupytext_version":"1.19.1"}},"content_includes_title":false,"authors":[{"nameParsed":{"literal":"Jonathan Taylor","given":"Jonathan","family":"Taylor"},"name":"Jonathan Taylor","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/executablebooks/jupyter-book","source_url":"https://github.com/executablebooks/jupyter-book/blob/main/docs/compare_scipy.md","edit_url":"https://github.com/executablebooks/jupyter-book/edit/main/docs/compare_scipy.md","exports":[{"format":"md","filename":"compare_scipy.md","url":"https://jonathan-taylor.github.io/smoothing_spline//build/compare_scipy-41bc6152496e1a2e3b3af9239f79c0da.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"This document illustrates the differences in boundary behavior and extrapolation between ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"qxp5wxFxPY"},{"type":"inlineCode","value":"smoothing_spline.SplineFitter","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"SeYCLmgJc8"},{"type":"text","value":" and ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"QK8s55m6TB"},{"type":"inlineCode","value":"scipy.interpolate.make_smoothing_spline","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"ja4RHFaFgd"},{"type":"text","value":".","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"G9Ut4yRHKb"}],"key":"AXbauCzIRm"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"While both methods fit smoothing splines, ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"bjQ7J2QdTF"},{"type":"inlineCode","value":"smoothing_spline","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"mUbs1ufQDf"},{"type":"text","value":" explicitly implements ","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"u5zrjTheKY"},{"type":"strong","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"natural cubic splines","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"QobtFXIxCV"}],"key":"EHpTZpMIUa"},{"type":"text","value":", which implies that the function should be linear beyond the boundary knots (i.e., the second derivative is zero at the boundaries).","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"svQfzeEd5h"}],"key":"KTSHvnYoIh"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"We will demonstrate this by fitting both models to a dataset and observing their predictions outside the range of the training data.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"wCHPT2gBJl"}],"key":"hOuLNEzAVi"},{"type":"heading","depth":2,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Setup","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"tEEyP8N3tb"}],"identifier":"setup","label":"Setup","html_id":"setup","implicit":true,"key":"ggzVAEOOQi"}],"key":"TMpqm8lxTI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nfrom scipy.interpolate import make_smoothing_spline\nfrom smoothing_spline import SplineFitter\n\n# Generate synthetic data\nrng = np.random.default_rng(42)\nn = 50\nx = np.sort(rng.uniform(0, 10, n))\ny = np.sin(x) + rng.normal(0, 0.2, n)\n\n# Define extrapolation range (+/- 50% of data range)\nx_range = x.max() - x.min()\nx_plot = np.linspace(x.min() - 0.5 * x_range, x.max() + 0.5 * x_range, 200)","key":"bxldezatv5"},{"type":"outputs","id":"ZYa2Zo-2frfHTSw5t1U8S","children":[],"key":"VBrTgvx0vV"}],"key":"CaRGlft8Sa"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"Fitting the Models","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"leJ7xOh2r3"}],"identifier":"fitting-the-models","label":"Fitting the Models","html_id":"fitting-the-models","implicit":true,"key":"hHBePTSn25"},{"type":"paragraph","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"We will fit both models using a similar regularization strength. Note that the parameterization of ","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"uLKTo0h6TL"},{"type":"inlineMath","value":"\\lambda","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">λ</span></span></span></span>","key":"cjQbDP7EaK"},{"type":"text","value":" might differ slightly, but we will try to match the degrees of freedom or visual smoothness for a fair qualitative comparison. Here we fix ","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"tg1B8T6RX1"},{"type":"inlineCode","value":"lam","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"e3eGO0KSxL"},{"type":"text","value":" for ","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"dBN4KDUv1e"},{"type":"inlineCode","value":"make_smoothing_spline","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"cygiQXxZV1"},{"type":"text","value":" and use ","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"zL7XhUlMxX"},{"type":"inlineCode","value":"solve_gcv","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"AOb1bIXAEF"},{"type":"text","value":" or fixed lambda for ","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"MSti6VczCu"},{"type":"inlineCode","value":"SplineFitter","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"TCxsaGfkyh"},{"type":"text","value":".","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"b3pEw44MvA"}],"key":"CXuAQ9oY49"},{"type":"paragraph","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"For simplicity, let’s fix a lambda value that provides a reasonable smooth fit.","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"uWi4D29bfu"}],"key":"MXvJG6eqxe"}],"key":"uSS7PQPOZW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Fit smoothing_spline\n# We explicitly ask for a specific lambda or let GCV find one.\n# Let's use GCV for smoothing_spline to get a good fit first.\nfitter = SplineFitter(x, n_knots=25)\nlam_best = fitter.solve_gcv(y)\ny_ours = fitter.predict(x_plot)\n\n# Fit scipy.interpolate.make_smoothing_spline\n# scipy's lam is roughly related. We'll try to use a similar value or just pick one that looks good.\n# SciPy documentation says minimizes \\sum w_i (y_i - g(x_i))^2 + lam \\int g''(t)^2 dt\n# Our objective is essentially the same.\n# Note: SplineFitter scales x internally to [0, range]. Scipy does not?\n# Let's just try to match them or show the qualitative difference.\n# We'll calculate the lambda that scipy would use?\n# Let's just fit scipy with a specific lambda to ensure smoothness.\nlam_scipy = 1e-2 # heuristic\nspl_scipy = make_smoothing_spline(x, y, lam=lam_scipy)\ny_scipy = spl_scipy(x_plot)","key":"nybGSt6HQo"},{"type":"outputs","id":"_-n4yq2peWiAJy9yEgswG","children":[],"key":"prEl3IU53Q"}],"key":"zX4NeoyUG3"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"children":[{"type":"text","value":"Visualization","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"hc5dyfNV3M"}],"identifier":"visualization","label":"Visualization","html_id":"visualization","implicit":true,"key":"z8t4kjnj0N"},{"type":"paragraph","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"children":[{"type":"text","value":"Now we plot the data, the fitted curves within the data range, and the extrapolation.","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"dVyFt6d0gn"}],"key":"r7NAf4Bc92"}],"key":"WDXehU4ANU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, ax = plt.subplots(figsize=(10, 6))\n\n# Plot Data\nax.scatter(x, y, color='black', label='Data', zorder=5)\n\n# Plot smoothing_spline result\nax.plot(x_plot, y_ours, 'b-', linewidth=2, label='smoothing_spline (Natural)')\n\n# Plot scipy result\nax.plot(x_plot, y_scipy, 'r--', linewidth=2, label='scipy.interpolate.make_smoothing_spline')\n\n# Highlight data boundaries\nax.axvline(x.min(), color='gray', linestyle=':', alpha=0.5)\nax.axvline(x.max(), color='gray', linestyle=':', alpha=0.5)\n\nax.set_title('Extrapolation Behavior: Natural vs. SciPy Spline')\nax.legend()\nax.grid(True, alpha=0.3)\nax.set_ylim([-10,10])","key":"vi1y9aLmnT"},{"type":"outputs","id":"N_vr3NNIDb9Xhz8dvs_WE","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/plain":{"content":"(-10.0, 10.0)","content_type":"text/plain"}}},"key":"qSjebnXyGW"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1000x600 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"fed95778a20de1a9daffef55a28e750f","path":"https://jonathan-taylor.github.io/smoothing_spline//build/fed95778a20de1a9daffef55a28e750f.png"}}},"key":"RP71p67PAG"}],"key":"s4eIaQHHy8"}],"key":"l6p93bTt48"},{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"children":[{"type":"text","value":"Analysis","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"nG73Zwbrnf"}],"identifier":"analysis","label":"Analysis","html_id":"analysis","implicit":true,"key":"jgV0MYrNtg"},{"type":"paragraph","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"children":[{"type":"text","value":"As seen in the plot:","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"key":"q1kyR5SrV1"}],"key":"BwYdMEOuFu"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":99,"column":1},"end":{"line":102,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":99,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"strong","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"inlineCode","value":"smoothing_spline","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"cOt8A5OoPL"}],"key":"tPIX7pS9Yv"},{"type":"text","value":": The blue line becomes perfectly ","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"nePKyE1CAW"},{"type":"strong","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"linear","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"bGNhf2fY1U"}],"key":"NHULHF8TtF"},{"type":"text","value":" outside the vertical dashed lines (the data boundaries). This is the defining property of a ","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"d2sAuu9i3x"},{"type":"strong","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"natural cubic spline","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"ClikwlwXrG"}],"key":"K4MFJXZZci"},{"type":"text","value":". The second derivative is zero at the boundary knots, and this zero curvature is maintained during extrapolation.","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"pnuERDledy"}],"key":"Ia5ycvdXwc"}],"key":"eliC7G1cp2"},{"type":"listItem","spread":true,"position":{"start":{"line":101,"column":1},"end":{"line":102,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"children":[{"type":"strong","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"children":[{"type":"inlineCode","value":"scipy.interpolate.make_smoothing_spline","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"UVsR6N6uJx"}],"key":"oU6qTR394T"},{"type":"text","value":": The red dashed line usually exhibits ","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"L5rG4NacN6"},{"type":"strong","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"children":[{"type":"text","value":"cubic","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"WSbilXrWyS"}],"key":"cSAjaJf4Rd"},{"type":"text","value":" extrapolation (it curves away). While ","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"UwMJTVdfyM"},{"type":"inlineCode","value":"make_smoothing_spline","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"n6AMdmBuxB"},{"type":"text","value":" solves the smoothing spline objective, the returned B-spline object often extrapolates based on the polynomial form of the end segments, which is not necessarily constrained to be linear unless specific boundary knots or coefficients are enforced. In many statistical contexts, the “natural” boundary condition (linear extrapolation) is preferred to avoid wild oscillations outside the data range.","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"dJ1ayiEcjf"}],"key":"kRKehOfADQ"}],"key":"JwBXhgcjYd"}],"key":"C6FrzXTmjE"},{"type":"paragraph","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"children":[{"type":"text","value":"This highlights a key feature of the ","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"key":"zajmuJXWx8"},{"type":"inlineCode","value":"smoothing_spline","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"key":"HHOVkZZyID"},{"type":"text","value":" package: it guarantees safe, linear extrapolation by design.","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"key":"cML2G4gmNT"}],"key":"hsEm9KRT6L"}],"key":"Bj4tlAlaIZ"}],"key":"pMOReqoAvD"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Performance Comparison: Pure Python vs C++ Extension","url":"/compare-cpp","group":"Smoothing Spline"}}},"domain":"http://localhost:3000"}