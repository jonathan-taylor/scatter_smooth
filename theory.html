<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Smoothing Splines: Theory and Implementation &#8212; smoothing_spline  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Comparing smoothing_spline with R’s smooth.spline" href="compare_R.html" />
    <link rel="prev" title="Smoothing Spline Documentation" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="smoothing-splines-theory-and-implementation">
<h1>Smoothing Splines: Theory and Implementation<a class="headerlink" href="#smoothing-splines-theory-and-implementation" title="Link to this heading">¶</a></h1>
<p>This document outlines the theoretical background for the <code class="docutils literal notranslate"><span class="pre">smoothing_spline</span></code> package, synthesizing concepts from <em>The Elements of Statistical Learning</em> (Hastie, Tibshirani, Friedman), specifically Chapter 5. It also discusses the implementation details (Reinsch form vs. Basis form) and compares the features with R’s <code class="docutils literal notranslate"><span class="pre">smooth.spline</span></code>.</p>
<section id="the-smoothing-spline-problem">
<h2>1. The Smoothing Spline Problem<a class="headerlink" href="#the-smoothing-spline-problem" title="Link to this heading">¶</a></h2>
<p>The goal of smoothing splines is to find a function $f(x)$ that fits the data ${(x_i, y_i)}_{i=1}^N$ well while remaining smooth. This is formulated as the minimization of a penalized residual sum of squares:</p>
<p>$$
\min_{f} \sum_{i=1}^N (y_i - f(x_i))^2 + \lambda \int [f’’(t)]^2 dt
$$</p>
<p>where $\lambda \ge 0$ is a smoothing parameter.</p>
<ul class="simple">
<li><p>$\lambda = 0$: $f$ becomes an interpolating spline (passes through every point).</p></li>
<li><p>$\lambda 	o \infty$: $f$ approaches the linear least squares fit.</p></li>
</ul>
<section id="the-solution-natural-cubic-spline">
<h3>The Solution: Natural Cubic Spline<a class="headerlink" href="#the-solution-natural-cubic-spline" title="Link to this heading">¶</a></h3>
<p>Remarkably, the solution to this infinite-dimensional optimization problem is a finite-dimensional <strong>Natural Cubic Spline</strong> with knots at the unique values of $x_i$.</p>
<p>A natural cubic spline is a piecewise cubic polynomial that is continuous up to its second derivative, and linear beyond the boundary knots (i.e., its second derivative is zero at the boundaries).</p>
</section>
</section>
<section id="matrix-formulation">
<h2>2. Matrix Formulation<a class="headerlink" href="#matrix-formulation" title="Link to this heading">¶</a></h2>
<p>Since the solution is a linear combination of basis functions, we can write:
$$
f(x) = \sum_{j=1}^N 	heta_j N_j(x)
$$
where $N_j(x)$ are the natural cubic spline basis functions.</p>
<p>The optimization problem reduces to:
$$
\min_{	heta} (y - N	heta)^T (y - N	heta) + \lambda 	heta^T \Omega_N 	heta
$$</p>
<p>where:</p>
<ul class="simple">
<li><p>$N_{ij} = N_j(x_i)$ is the basis matrix.</p></li>
<li><p>$(\Omega_N)_{jk} = \int N_j’’(t) N_k’’(t) dt$ is the penalty matrix.</p></li>
</ul>
<p>The solution is a generalized ridge regression:
$$
\hat{	heta} = (N^T N + \lambda \Omega_N)^{-1} N^T y
$$</p>
<section id="reinsch-form-vs-basis-form">
<h3>Reinsch Form vs. Basis Form<a class="headerlink" href="#reinsch-form-vs-basis-form" title="Link to this heading">¶</a></h3>
<p>There are two primary ways to compute the solution.</p>
<section id="a-the-basis-form-used-in-this-package">
<h4>A. The Basis Form (Used in this Package)<a class="headerlink" href="#a-the-basis-form-used-in-this-package" title="Link to this heading">¶</a></h4>
<p>We explicitly construct the basis matrix $N$ and the penalty matrix $\Omega$.</p>
<ul class="simple">
<li><p>We use the property that a natural cubic spline is determined by its values and second derivatives at the knots.</p></li>
<li><p>Our C++ implementation constructs $N$ efficiently by solving the tridiagonal system that relates second derivatives to values.</p></li>
<li><p>We then solve the dense linear system $(N^T N + \lambda \Omega)	heta = N^T y$.</p></li>
</ul>
<p><strong>Why Basis Form?</strong></p>
<ul class="simple">
<li><p>Allows for <strong>Regression Splines</strong>: We can choose fewer knots than data points ($K &lt; N$). The math remains identical, but the matrices are smaller ($K 	imes K$ instead of $N 	imes N$).</p></li>
<li><p>Easier to extend to weighted least squares or other loss functions.</p></li>
</ul>
</section>
<section id="b-the-reinsch-form-used-in-r-s-smooth-spline">
<h4>B. The Reinsch Form (Used in R’s <code class="docutils literal notranslate"><span class="pre">smooth.spline</span></code>)<a class="headerlink" href="#b-the-reinsch-form-used-in-r-s-smooth-spline" title="Link to this heading">¶</a></h4>
<p>If knots are placed at every data point ($K=N$), the solution vector $\mathbf{f} = (f(x_1), \dots, f(x_N))^T$ can be found directly without forming $N$.
$$
\hat{\mathbf{f}} = (I + \lambda K)^{-1} y
$$
where $K = Q R^{-1} Q^T$.</p>
<ul class="simple">
<li><p>$Q$ is an $N 	imes (N-2)$ tridiagonal matrix of second differences ($1/h_i$).</p></li>
<li><p>$R$ is an $(N-2) 	imes (N-2)$ tridiagonal matrix ($h_i$).</p></li>
</ul>
<p>This allows solving the system in $O(N)$ time using banded solvers, making it extremely fast for large $N$.</p>
<p><strong>Our Implementation Note:</strong>
While we use the basis form, our construction of $\Omega$ utilizes the exact same $Q R^{-1} Q^T$ structure (computed via sparse Cholesky) to ensure mathematical equivalence to the integral penalty.</p>
</section>
</section>
</section>
<section id="degrees-of-freedom-df">
<h2>3. Degrees of Freedom ($df$)<a class="headerlink" href="#degrees-of-freedom-df" title="Link to this heading">¶</a></h2>
<p>The smoothing parameter $\lambda$ is abstract. A more intuitive measure of model complexity is the <strong>effective degrees of freedom ($df$)</strong>.</p>
<p>$$
df(\lambda) = 	ext{trace}(\mathbf{S}_\lambda)
$$</p>
<p>where $\mathbf{S}<em>\lambda$ is the smoother matrix such that $\hat{y} = \mathbf{S}</em>\lambda y$.
In our formulation:
$$
\mathbf{S}_\lambda = N (N^T N + \lambda \Omega)^{-1} N^T
$$</p>
<p>The relationship between $df$ and $\lambda$ is monotonic.</p>
<ul class="simple">
<li><p>$df 	o 2$ as $\lambda 	o \infty$ (Linear fit).</p></li>
<li><p>$df 	o N$ as $\lambda 	o 0$ (Interpolation).</p></li>
</ul>
<p>Our package allows specifying <code class="docutils literal notranslate"><span class="pre">df</span></code> directly. We use a root-finding algorithm (Brent’s method) to find the unique $\lambda$ that yields the requested $df$.</p>
</section>
<section id="comparison-with-r-s-smooth-spline">
<h2>4. Comparison with R’s <code class="docutils literal notranslate"><span class="pre">smooth.spline</span></code><a class="headerlink" href="#comparison-with-r-s-smooth-spline" title="Link to this heading">¶</a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Feature</p></th>
<th class="head text-left"><p><code class="docutils literal notranslate"><span class="pre">smooth.spline</span></code> (R)</p></th>
<th class="head text-left"><p><code class="docutils literal notranslate"><span class="pre">smoothing_spline</span></code> (Python)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>Algorithm</strong></p></td>
<td class="text-left"><p>Reinsch Form ($O(N)$)</p></td>
<td class="text-left"><p>Basis Form ($O(NK^2)$ or $O(K^3)$)</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Knots</strong></p></td>
<td class="text-left"><p>All unique $x$ (default) or $nknots$</p></td>
<td class="text-left"><p>All unique $x$ or specified <code class="docutils literal notranslate"><span class="pre">n_knots</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Input $\lambda$</strong></p></td>
<td class="text-left"><p>Via <code class="docutils literal notranslate"><span class="pre">spar</span></code> or <code class="docutils literal notranslate"><span class="pre">lambda</span></code></p></td>
<td class="text-left"><p>Via <code class="docutils literal notranslate"><span class="pre">lamval</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Input $df$</strong></p></td>
<td class="text-left"><p>Supported</p></td>
<td class="text-left"><p>Supported (via root finding)</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Automatic Tuning</strong></p></td>
<td class="text-left"><p>GCV / CV</p></td>
<td class="text-left"><p><strong>Not yet implemented</strong></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Weights</strong></p></td>
<td class="text-left"><p>Supported</p></td>
<td class="text-left"><p>Supported</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><strong>Derivatives</strong></p></td>
<td class="text-left"><p>Built-in</p></td>
<td class="text-left"><p><strong>Not yet exposed</strong> (Backend supports it)</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Extrapolation</strong></p></td>
<td class="text-left"><p>Linear (via <code class="docutils literal notranslate"><span class="pre">predict</span></code>)</p></td>
<td class="text-left"><p>Linear (explicitly handled)</p></td>
</tr>
</tbody>
</table>
<section id="key-differences">
<h3>Key Differences<a class="headerlink" href="#key-differences" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Speed:</strong> For $N=10,000$, <code class="docutils literal notranslate"><span class="pre">smooth.spline</span></code> is faster because it exploits the band structure of the full system. Our implementation allows <code class="docutils literal notranslate"><span class="pre">n_knots</span> <span class="pre">&lt;</span> <span class="pre">N</span></code> (Regression Splines), which restores speed ($O(N K^2)$) and reduces overfitting risk, a feature <code class="docutils literal notranslate"><span class="pre">smooth.spline</span></code> supports via <code class="docutils literal notranslate"><span class="pre">nknots</span></code>.</p></li>
<li><p><strong>Spar (R specific):</strong> R uses a scaling parameter <code class="docutils literal notranslate"><span class="pre">spar</span></code> related to $\lambda$. We use raw $\lambda$ (scaled by $x$-range cubed for numerical stability).</p></li>
</ol>
</section>
</section>
<section id="references">
<h2>5. References<a class="headerlink" href="#references" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Hastie, T., Tibshirani, R., &amp; Friedman, J. (2009). <em>The Elements of Statistical Learning: Data Mining, Inference, and Prediction</em>. 2nd Edition. Springer. (Chapter 5).</p></li>
<li><p>Green, P. J., &amp; Silverman, B. W. (1994). <em>Nonparametric Regression and Generalized Linear Models: A Roughness Penalty Approach</em>. Chapman and Hall/CRC.</p></li>
</ol>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">smoothing_spline</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Smoothing Splines: Theory and Implementation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-smoothing-spline-problem">1. The Smoothing Spline Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="#matrix-formulation">2. Matrix Formulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#degrees-of-freedom-df">3. Degrees of Freedom ($df$)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#comparison-with-r-s-smooth-spline">4. Comparison with R’s <code class="docutils literal notranslate"><span class="pre">smooth.spline</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#references">5. References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="compare_R.html">Comparing <code class="docutils literal notranslate"><span class="pre">smoothing_spline</span></code> with R’s <code class="docutils literal notranslate"><span class="pre">smooth.spline</span></code></a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Smoothing Spline Documentation</a></li>
      <li>Next: <a href="compare_R.html" title="next chapter">Comparing <code class="docutils literal notranslate"><span class="pre">smoothing_spline</span></code> with R’s <code class="docutils literal notranslate"><span class="pre">smooth.spline</span></code></a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Jonathan Taylor.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/theory.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>